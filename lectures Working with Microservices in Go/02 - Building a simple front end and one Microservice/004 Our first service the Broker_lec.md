Теперь, когда у нас есть простое фронтенд-приложение, давайте начнем с сервиса брокера.

Первым делом остановим фронтенд, который у нас еще запущен. Нажимаем в терминале `Control + C`, чтобы остановить его, и закрываем терминал.

Теперь создадим новую папку на том же уровне, что и фронтенд. Если мы попробуем сделать это через кнопку, она добавит папку внутрь фронтенд, так как это рабочее пространство. Вместо этого откроем Finder и найдем папку, где находится фронтенд. Создадим новую папку и назовем её `broker-service`, рядом с папкой фронтенд.

Возвращаемся в Visual Studio Code, идем в меню `File` и выбираем `Add Folder to Workspace`. Найдем и добавим папку `broker-service`.

Теперь у нас есть папка `broker-service`. Открываем терминал, поднимаемся на уровень выше и переходим в папку `broker-service`. Вводим команду `go mod init` и указываем имя модуля, например, `broker`. Вы можете назвать его `github.com/ваше_имя/broker` или как вам удобно, но для простоты оставим просто `broker`.

Эта команда создаст файл `go.mod`. Закроем терминал и создадим в папке `broker-service` новую папку `cmd`, что стандартно для веб-приложений. Внутри `cmd` создадим еще одну папку `api`. Наконец, внутри `api` создадим файл `main.go`, который будет основным входом в сервис брокера.

Начнем с написания кода. В файле `main.go` указываем пакет `main` и создаем основную функцию `main`. Пока что сделаем её простой. Мы хотим, чтобы на корневом уровне приложения был один маршрут `/`, который принимает JSON-пейлоад, обрабатывает его и возвращает ответ, подтверждающий получение.

Со временем этот брокер станет намного сложнее, он будет принимать запросы и передавать их микросервисам, затем возвращать ответ. Для упрощения работы установим сторонний пакет маршрутизации.

Открываем терминал, убеждаемся, что мы в папке `broker-service`, и выполняем команду:

```
go get github.com/go-chi/chi/v5
```

Если вы проходите курс в версии 6, используйте версию 5 для курса, так как при изменении мажорной версии часто бывают нарушения совместимости. После курса можно обновиться до версии 6.

Также добавим пакет для промежуточного ПО (middleware):

```
go get github.com/go-chi/chi/v5/middleware
```

И пакет для обработки CORS (междоменных запросов):

```
go get github.com/go-chi/cors
```

Теперь вернемся в папку `cmd/api` и создадим новый файл `routes.go`, где будем определять маршруты для нашего приложения. Укажем пакет `main`, создадим функцию `routes`, которая возвращает `http.Handler`.

Внутри функции создадим переменную `mux` типа `chi.Router`:

```go
mux := chi.NewRouter()
```

Теперь настроим CORS, чтобы определить, кто может подключаться. Это делается просто с помощью chi. Указываем, что все источники разрешены для разработки:

```go
mux.Use(cors.Handler(cors.Options{
    AllowedOrigins:   []string{"http://*", "https://*"},
    AllowedMethods:   []string{"GET", "POST", "PUT", "DELETE", "OPTIONS"},
    AllowedHeaders:   []string{"Accept", "Authorization", "Content-Type", "X-CSRF-Token"},
    ExposedHeaders:   []string{"Link"},
    AllowCredentials: true,
    MaxAge:           300,
}))
```

Добавим также встроенное промежуточное ПО для проверки "heartbeat":

```go
mux.Use(middleware.Heartbeat("/ping"))
```

Пока что у нас нет обработчиков, но мы можем вернуть `mux`:

```go
return mux
```

Добавим приемник в функции `routes` для передачи конфигурации приложения, если это потребуется.

Вернемся к `main.go`, перед основной функцией объявим константу для порта:

```go
const webPort = "80"
```

Объявим тип `config` как пустую структуру:

```go
type config struct{}
```

В основной функции создадим переменную `app` типа `config` и выведем сообщение в лог о запуске сервиса:

```go
app := config{}
log.Printf("Starting broker service on port %s\n", webPort)
```

Теперь определим и запустим HTTP-сервер:

```go
srv := &http.Server{
    Addr:    fmt.Sprintf(":%s", webPort),
    Handler: app.routes(),
}

if err := srv.ListenAndServe(); err != nil {
    log.Panic(err)
}
```

Теперь мы можем открыть терминал, очистить экран и запустить сервер, чтобы убедиться, что все компилируется:

```sh
go run main.go
```

Таким образом, мы создали и запустили базовый сервис брокера, который будет принимать и обрабатывать запросы.