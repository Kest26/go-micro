## Добавление базового логирования в сервис аутентификации

### Цель: Логирование успешной аутентификации

Перед тем как протестировать наш новый сервис логирования `logger-service`, давайте добавим в сервис аутентификации `authentication-service` логику, которая будет записывать в лог факт успешной аутентификации пользователя. Для этого нам нужно обновить код в обработчике аутентификации `Authenticate`.

### Обновление обработчика аутентификации

Откроем проект сервиса аутентификации, перейдём в папку `cmd`, а затем откроем файл `handlers.go`. Этот файл содержит обработчики запросов, включая аутентификацию `Authenticate`.

Мы хотим добавить логирование прямо перед отправкой JSON-ответа клиенту. Для этого создадим отдельную функцию, которая будет отвечать за логирование, что упростит тестирование и поддержку кода.

### Реализация функции логирования

Добавим новую функцию в наш код, которая будет выглядеть следующим образом:

```go
func (app *Config) logRequest(name, data string) error {
    var entry struct {
        Name string `json:"name"`
        Data string `json:"data"`
    }

    entry.Name = name
    entry.Data = data

    jsonData, _ := json.MarshalIndent(entry, "", "\t")
    logServiceURL := "http://logger-service/log"

    request, err := http.NewRequest("POST", logServiceURL, bytes.NewBuffer(jsonData))
    if err != nil {
        return err
    }

    client := &http.Client{}
    _, err = client.Do(request)
    if err != nil {
        return err
    }

    return nil
}
```

Эта функция принимает два параметра: `name` и `data`, которые будут записаны в лог. Внутри функции создаётся структура с этими данными, которая затем конвертируется в JSON. Далее формируется HTTP-запрос на URL лог-сервиса и отправляется POST-запрос с JSON-данными.

### Встраивание логики в обработчик аутентификации

Теперь добавим вызов этой функции в основной обработчик аутентификации:

```go
err = app.logRequest("authentication", fmt.Sprintf("%s logged in", user.Email))
if err != nil {
    app.errorJSON(w, err)
    return
}
```

Этот код записывает в лог сообщение с информацией о том, что конкретный пользователь успешно вошёл в систему.

### Завершение и тестирование

Если всё сделано правильно, мы сможем собрать новые образы Docker, запустить наш фронтенд и протестировать работу логирования. В следующей лекции мы попробуем это сделать.
